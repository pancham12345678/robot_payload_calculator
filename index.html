<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Payload Capacity Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: Calm Neutrals -->
    <!-- Application Structure Plan: A dashboard-style SPA with four sections: 1) System Parameters (static), 2) Interactive Controls (velocity slider), 3) Key Results (max payload card & summary chart), and 4) Detailed Iteration Table. This structure guides the user from understanding the base system to interactively simulating and analyzing the primary question (max payload), presenting the final answer clearly and providing detailed data for validation. It prioritizes the answer-first principle while allowing for deeper exploration. -->
    <!-- Visualization & Content Choices: Report Info: Max Power (V, I), Mass, Friction, Acceleration. Goal: Find max payload. Viz/Method: 1. Main result displayed in a large summary card for clarity. 2. A Chart.js bar chart to visually compare the calculated power demand (startup vs. cruising) against the driver's power limit. Interaction: A slider controls the safe velocity, which triggers recalculations. Justification: This combination makes the core constraint (power limit) immediately obvious and allows the user to explore how operating speed impacts payload capacity. The iteration table provides transparency. Library: Chart.js for the bar chart. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            background-color: #f5f5f2;
            color: #333;
            font-family: 'Inter', sans-serif;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            transition: all 0.3s ease-in-out;
        }
        .header-icon {
            width: 50px;
            height: 50px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: #e5e7eb;
            color: #1f2937;
            font-size: 1.5rem;
            font-weight: bold;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #111827;
        }
        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <header class="text-center mb-8">
            <div class="flex justify-center items-center gap-4 mb-4">
                <div class="header-icon">
                    <span>&#9881;</span>
                </div>
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Robot Payload Capacity Calculator</h1>
            </div>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto">
                This tool analyzes the robot's dynamic performance to determine the maximum sustainable payload based on its motor driver's power limits. Adjust the cruising velocity to see how it impacts the payload capacity.
            </p>
        </header>

        <main class="space-y-8">
            <section id="parameters" class="card">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">Core System Parameters</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 text-center">
                    <div class="p-2 bg-gray-50 rounded-lg">
                        <div class="stat-value" id="voltage">11.1 V</div>
                        <div class="stat-label">Supply Voltage</div>
                    </div>
                    <div class="p-2 bg-gray-50 rounded-lg">
                        <div class="stat-value" id="current">0.9 A</div>
                        <div class="stat-label">Current Limit</div>
                    </div>
                    <div class="p-2 bg-gray-50 rounded-lg">
                        <div class="stat-value" id="powerLimit">9.99 W</div>
                        <div class="stat-label">Max Power</div>
                    </div>
                    <div class="p-2 bg-gray-50 rounded-lg">
                        <div class="stat-value" id="robotMass">2.381 kg</div>
                        <div class="stat-label">Robot Mass</div>
                    </div>
                    <div class="p-2 bg-gray-50 rounded-lg">
                        <div class="stat-value" id="frictionCoeff">0.01</div>
                        <div class="stat-label">Rolling Friction Coeff.</div>
                    </div>
                     <div class="p-2 bg-gray-50 rounded-lg">
                        <div class="stat-value" id="acceleration">0.554 m/sÂ²</div>
                        <div class="stat-label">Cmd. Acceleration</div>
                    </div>
                </div>
            </section>
            
            <section id="simulation" class="card">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">Interactive Simulation</h2>
                <div class="flex flex-col md:flex-row items-center justify-center gap-6">
                    <div class="w-full md:w-2/3">
                        <label for="velocitySlider" class="block text-lg font-medium text-gray-700 mb-2">
                            Set Safe Cruising Velocity: <span id="velocityValue" class="font-bold text-blue-600"></span>
                        </label>
                        <input id="velocitySlider" type="range" min="50" max="95" value="75" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>Slower (50%)</span>
                            <span>Faster (95%)</span>
                        </div>
                    </div>
                </div>
                 <p class="text-center text-sm text-gray-500 mt-4">The simulation calculates the maximum payload the robot can accelerate from a standstill to your selected cruising velocity without exceeding the motor driver's power limit.</p>
            </section>

            <section id="results" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="card flex flex-col justify-center items-center text-center">
                     <h2 class="text-2xl font-semibold text-gray-700 mb-4">Maximum Capacity</h2>
                     <div class="bg-blue-100 text-blue-800 rounded-full p-4 mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                    </div>
                    <div class="mb-2">
                        <span id="maxPayload" class="text-5xl font-bold text-blue-600">--</span>
                        <span class="text-xl text-gray-600">kg</span>
                    </div>
                    <div class="text-lg font-medium text-gray-800">Maximum Sustainable Payload</div>
                    <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-4 w-full">
                        <div class="p-2 bg-gray-100 rounded-lg">
                            <div id="totalMass" class="stat-value text-xl">--</div>
                            <div class="stat-label">Total Mass</div>
                        </div>
                        <div class="p-2 bg-gray-100 rounded-lg">
                            <div id="startupPower" class="stat-value text-xl">--</div>
                            <div class="stat-label">Startup Power</div>
                        </div>
                        <div class="p-2 bg-gray-100 rounded-lg">
                            <div id="cruisingPower" class="stat-value text-xl">--</div>
                            <div class="stat-label">Cruising Power</div>
                        </div>
                    </div>
                </div>
                <div class="card">
                     <h2 class="text-2xl font-semibold text-gray-700 mb-4 text-center">Power Analysis</h2>
                     <div class="chart-container">
                        <canvas id="powerChart"></canvas>
                     </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const CONSTANTS = {
                robotMass: 2.381,
                wheelRadius: 0.0485,
                supplyVoltage: 11.1,
                currentLimit: 0.9,
                coeffRollingFriction: 0.01,
                g: 9.81,
                maxLinearVelocity: 1.0837,
                commandedAcceleration: 0.5536,
                get maxPower() {
                    return this.supplyVoltage * this.currentLimit;
                }
            };

            const ui = {
                velocitySlider: document.getElementById('velocitySlider'),
                velocityValue: document.getElementById('velocityValue'),
                maxPayload: document.getElementById('maxPayload'),
                totalMass: document.getElementById('totalMass'),
                startupPower: document.getElementById('startupPower'),
                cruisingPower: document.getElementById('cruisingPower'),
                powerChartCanvas: document.getElementById('powerChart'),
            };

            let powerChart;

            function calculateMaxPayload() {
                const velocityPercentage = parseInt(ui.velocitySlider.value);
                const safeVelocity = CONSTANTS.maxLinearVelocity * (velocityPercentage / 100);
                
                ui.velocityValue.textContent = `${safeVelocity.toFixed(2)} m/s (${velocityPercentage}%)`;

                let payloadMass = 0;
                let maxSustainablePayload = 0;
                let lastValidResults = {};
                const increment = 0.1;

                while (true) {
                    const totalMass = CONSTANTS.robotMass + payloadMass;
                    
                    const rollingForce = CONSTANTS.coeffRollingFriction * totalMass * CONSTANTS.g;
                    const inertialForce = totalMass * CONSTANTS.commandedAcceleration;
                    const totalStartupForce = rollingForce + inertialForce;

                    const powerStartupPeak = totalStartupForce * safeVelocity;
                    const powerCruising = rollingForce * safeVelocity;

                    if (powerStartupPeak <= CONSTANTS.maxPower) {
                        maxSustainablePayload = payloadMass;
                        lastValidResults = {
                            totalMass: totalMass,
                            startupPower: powerStartupPeak,
                            cruisingPower: powerCruising,
                        };
                        payloadMass += increment;
                    } else {
                        break;
                    }
                }
                updateResultsUI(maxSustainablePayload, lastValidResults);
                updateChart(lastValidResults);
            }

            function updateResultsUI(payload, results) {
                ui.maxPayload.textContent = payload > 0 ? payload.toFixed(1) : "0.0";
                ui.totalMass.textContent = results.totalMass ? `${results.totalMass.toFixed(2)} kg` : '--';
                ui.startupPower.textContent = results.startupPower ? `${results.startupPower.toFixed(2)} W` : '--';
                ui.cruisingPower.textContent = results.cruisingPower ? `${results.cruisingPower.toFixed(2)} W` : '--';
            }

            function initializeChart() {
                const ctx = ui.powerChartCanvas.getContext('2d');
                powerChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Startup Power', 'Cruising Power', 'Driver Power Limit'],
                        datasets: [{
                            label: 'Power (Watts)',
                            data: [0, 0, CONSTANTS.maxPower],
                            backgroundColor: [
                                'rgba(239, 68, 68, 0.6)',
                                'rgba(59, 130, 246, 0.6)',
                                'rgba(34, 197, 94, 0.6)'
                            ],
                            borderColor: [
                                'rgba(239, 68, 68, 1)',
                                'rgba(59, 130, 246, 1)',
                                'rgba(34, 197, 94, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        scales: {
                            x: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Power (Watts)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.x !== null) {
                                            label += context.parsed.x.toFixed(2) + ' W';
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            function updateChart(results) {
                if (!powerChart) {
                    initializeChart();
                }
                powerChart.data.datasets[0].data[0] = results.startupPower || 0;
                powerChart.data.datasets[0].data[1] = results.cruisingPower || 0;
                powerChart.data.datasets[0].data[2] = CONSTANTS.maxPower;
                powerChart.update();
            }

            ui.velocitySlider.addEventListener('input', calculateMaxPayload);
            
            initializeChart();
            calculateMaxPayload();
        });
    </script>
</body>
</html>
